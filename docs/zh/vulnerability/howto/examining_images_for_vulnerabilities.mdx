---
weight: 15
sourceSHA: 239e33c6168a7ad5a010bfd3475348db921b2433038ad579162f4b78c736f3f6
---

# 检查图像中的漏洞

Alauda Container Security for Kubernetes 使您能够使用内置的 Scanner V4 分析容器图像中的漏洞。该扫描器检查图像层，识别软件包，并将其与来自 NVD、OSV 和特定操作系统源的漏洞数据库进行匹配。

> **注意：**
> Alauda Container Security 使用 Scanner V4（基于 ClairCore）作为默认和唯一支持的漏洞扫描器。

当检测到漏洞时，Alauda Container Security 会：

- 在 **漏洞管理** 视图中显示它们
- 对其进行排名并突出显示以进行风险评估
- 将其与启用的 [安全策略](../../policy/guides/view_security_policy.mdx) 进行检查

扫描器通过检查特定文件来识别已安装的组件。如果这些文件缺失，某些漏洞可能无法被检测到。所需文件包括：

| 组件类型                     | 所需文件                                                                                                                                                                                         |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 包管理器                     | `/etc/alpine-release`; `/etc/lsb-release`; `/etc/os-release` 或 `/usr/lib/os-release`; `/etc/oracle-release`; `/etc/centos-release`; `/etc/redhat-release`; `/etc/system-release`; 其他类似文件 |
| 语言级依赖                   | `package.json`（JavaScript）；`dist-info`/`egg-info`（Python）；`MANIFEST.MF`（Java JAR）                                                                                                         |
| 应用级依赖                   | `dotnet/shared/Microsoft.AspNetCore.App/`; `dotnet/shared/Microsoft.NETCore.App/`                                                                                                                |

## Scanner V4 概述

Scanner V4 自 4.4 版本以来可用，增强了对语言和操作系统特定组件的扫描。Scanner V4 默认启用，并且在所有漏洞扫描场景中都是必需的。

> **注意：**
> Scanner V4 仅考虑 2014 年及以后的 Red Hat 产品漏洞。

### 启用 Scanner V4

Scanner V4 在 Alauda Container Security 中默认启用。新部署无需额外配置。

## 扫描器工作流程

1. Central 请求 Scanner V4 Indexer 分析图像。
2. Indexer 拉取元数据并下载图层。
3. Indexer 生成索引报告。
4. Matcher 将图像与漏洞进行匹配并生成报告。

## 常见扫描器警告消息

| 消息                                                                   | 描述                                        |
| ---------------------------------------------------------------------- | ------------------------------------------- |
| 无法检索操作系统 CVE 数据，仅提供语言 CVE 数据                        | 基础操作系统不受支持；没有操作系统级 CVE。  |
| 操作系统 CVE 数据过时                                                  | 操作系统已达到生命周期结束；数据可能过时。  |
| 无法获取基础操作系统信息                                              | 扫描器无法确定基础操作系统。                |
| 无法从注册表检索元数据                                                | 注册表无法访问或身份验证失败。              |
| 图像超出 Red Hat 漏洞扫描器认证范围                                   | 图像过旧，无法认证。                        |

> **提示：**
> 使用 2020 年 6 月之后的基础镜像以获得最佳结果。

## 支持的 Linux 发行版

| 发行版        | 版本                                                                                                         |
| -------------- | ------------------------------------------------------------------------------------------------------------- |
| Alpine Linux   | `alpine:3.2`–`alpine:3.21`，`alpine:edge`                                                                       |
| Amazon Linux   | `amzn:2018.03`，`amzn:2`，`amzn:2023`                                                                           |
| CentOS         | `centos:6`，`centos:7`，`centos:8`                                                                              |
| Debian         | `debian:11`，`debian:12`，`debian:unstable`，[`Distroless`](https://github.com/GoogleContainerTools/distroless) |
| Oracle Linux   | `ol:5`–`ol:9`                                                                                                   |
| Photon OS      | `photon:1.0`–`photon:3.0`                                                                                       |
| RHEL           | `rhel:6`–`rhel:9`                                                                                               |
| SUSE           | `sles:11`–`sles:15`，`opensuse-leap:15.5`，`opensuse-leap:15.6`                                                 |
| Ubuntu         | `ubuntu:14.04`–`ubuntu:24.10`                                                                                   |

> **注意：**
> 一些较旧的 Debian/Ubuntu 版本未由供应商更新。Fedora 不支持操作系统 CVE。

## 支持的包格式

| 包格式         | 包管理器                |
| -------------- | ----------------------- |
| apk            | apk                     |
| dpkg           | apt; dpkg               |
| rpm            | dnf; microdnf; rpm; yum |

## 支持的编程语言

| 语言          | 包格式                                                        |
| -------------- | ------------------------------------------------------------- |
| Go             | 二进制文件（分析标准库，如果存在，则分析 `go.mod` 依赖）     |
| Java           | JAR; WAR; EAR; JPI; HPI                                       |
| JavaScript     | package.json                                                  |
| Python         | egg; wheel                                                    |
| Ruby           | gem                                                           |

## 支持的容器镜像层格式

| 格式           | Scanner V4 |
| -------------- | ---------- |
| 无压缩         | 是         |
| bzip2          | 是         |
| gzip           | 是         |
| xz             | 否         |
| zstd           | 是         |

## 委托图像扫描

Alauda Container Security 支持使用 ICSP、IDMS 和 ITMS 等自定义资源对来自注册表镜像的图像进行委托扫描。Scanner-slim 可以在安全集群中索引图像并将结果发送到 Central 进行漏洞匹配。可以为所有、无或特定注册表配置委托。

**先决条件：**

- 在安全集群中安装扫描器。

**步骤：**

1. 在门户中，转到 **平台配置 > 集群**。
2. 点击 **委托扫描**。
3. 配置委托范围和默认集群。
4. 可选地，添加源注册表和目标集群对。
5. 点击 **保存**。

## 图像扫描和观察列表

Alauda Container Security 每 4 小时扫描所有活动图像。您还可以通过 **观察** 设置启用对非活动图像的自动扫描（从版本 3.0.57 开始）。

**步骤：**

1. 在门户中，转到 **漏洞管理 > 结果**。
2. 点击 **更多视图 > 非活动图像**。
3. 点击 **管理观察图像**，根据需要添加或删除图像。

> **注意：**
> 删除图像的数据将在 **系统配置** 中保留配置的时间段。

## 漏洞数据更新

Central 每 5 分钟从 `https://definitions.stackrox.io` 获取漏洞定义，并每 3 小时刷新一次。您可以通过以下命令调整更新间隔：

```bash
kubectl -n stackrox set env deploy/central ROX_SCANNER_VULN_UPDATE_INTERVAL=<value>
```

Scanner V4 使用来自 Central 的数据。有关更多信息，请参见架构文档中的"漏洞来源"。

## CVSS 评分

Alauda Container Security 为每个漏洞显示一个 CVSS 基础分数：

- 如果可用，显示 CVSS v3（需要 Scanner V4）
- 否则，显示 CVSS v2

API 响应可能包括可用的 v2 和 v3 分数。对于 Red Hat 安全通告（RHSA），显示相关 CVE 中的最高 CVSS 分数。

## 禁用特定语言的扫描

要禁用特定语言的漏洞扫描：

```bash
kubectl -n stackrox set env deploy/scanner ROX_LANGUAGE_VULNS=false
```

- [Red Hat CVE 数据库](https://access.redhat.com/security/cve)
