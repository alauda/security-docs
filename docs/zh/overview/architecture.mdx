---
weight: 15
sourceSHA: bd7faef9b55f2c672f86234dd43d3a8f82075972fb11187c357a8f5381132bbe
---

## 架构

---

Alauda 容器安全（ACS）针对 Kubernetes 4.7

### 系统架构

**摘要**

本文档提供了 Alauda 容器安全（ACS）在 Kubernetes 环境中的架构概述。

---

ACS 采用分布式、基于容器的架构，以实现对 Alauda 容器平台或 Kubernetes 集群的可扩展、低影响的安全性。

**关键组件**

- **中央服务**：部署在单个集群上，提供管理、API 和用户界面（ACS 门户）。包括中央服务、中央数据库（PostgreSQL 13）和 Scanner V4 漏洞扫描器。
- **受保护集群服务**：部署在每个受保护的集群上。包括传感器（集群监控和策略执行）、准入控制器（策略准入）、收集器（运行时和网络数据收集）以及可选的扫描组件。

**扫描器概述**

- **Scanner V4**：自 4.7 版本以来的默认和唯一支持的扫描器。支持特定于语言和操作系统的镜像扫描。由索引器、匹配器和数据库组成。

**漏洞来源**

- Scanner V4：Red Hat VEX、Red Hat CVE 映射、OSV、NVD 及其他操作系统来源。

**部署说明**

- Operator 在每个集群上安装轻量级的 Scanner V4，以实现集成的注册表扫描。
- Helm 安装需要 `scannerV4.disable=false` 以启用轻量级的 Scanner V4。
- 如果中央服务和受保护集群服务共享命名空间，则仅中央服务部署 Scanner V4 组件。

**外部集成**

- 第三方系统（CI/CD、SIEM、日志记录、电子邮件）
- roxctl CLI
- 镜像注册表（自动/手动集成）
- definitions.stackrox.io（漏洞信息源）
- collector-modules.stackrox.io（内核模块）

### 组件交互

#### ACS 与 Scanner V4

| 组件                | 方向     | 组件                | 描述                                      |
| ------------------- | -------- | ------------------- | ----------------------------------------- |
| 中央服务            | ⮂        | Scanner V4 索引器  | 镜像索引和报告生成                        |
| 中央服务            | ⮂        | Scanner V4 匹配器  | 漏洞匹配和报告                            |
| 传感器              | ⮂        | Scanner V4 索引器  | 委托的镜像索引                            |
| Scanner V4 索引器  | →        | 镜像注册表         | 拉取镜像元数据和层                        |
| Scanner V4 匹配器  | →        | Scanner V4 索引器  | 获取索引报告                              |
| Scanner V4 索引器  | →        | Scanner V4 数据库   | 存储索引结果                              |
| Scanner V4 匹配器  | →        | Scanner V4 数据库   | 存储和更新漏洞数据                        |
| 传感器              | ⮂        | 中央服务            | 配置和事件同步                            |
| 收集器              | ⮂        | 传感器              | 发送运行时/网络数据                       |
| 准入控制器         | ⮂        | 传感器              | 策略执行和扫描请求                       |
| 准入控制器         | →        | 中央服务            | 如果传感器不可用则进行直接通信           |

### 默认端口和协议

| 连接                          | 类型       | 端口 | 备注                               |
| ----------------------------- | ---------- | ---- | ---------------------------------- |
| 中央服务 ↔ Scanner V4 索引器 | gRPC       | 8443 |                                    |
| 中央服务 ↔ 传感器            | TCP/gRPC   | 443  | 双向，传感器发起                   |
| 中央服务 ↔ CLI               | gRPC/HTTPS | 443  | 详见 `roxctl` 的选项               |
| 中央服务 ↔ 漏洞信息源       | HTTPS      | 443  | definitions.stackrox.io            |
| 收集器 → 传感器              | gRPC       | 443  |                                    |
| 收集器（合规性） → 传感器    | gRPC       | 8444 | 如果启用节点扫描                  |
| Scanner V4 索引器 → 中央服务 | HTTPS      | 443  |                                    |
| Scanner V4 索引器/匹配器 → 数据库 | TCP    | 5432 |                                    |
| 传感器 ↔ 准入控制器         | gRPC       | 443  | 双向                               |
